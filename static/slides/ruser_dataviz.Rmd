---
title: "Sentiment Analysis of a CHILDES Corpus"
subtitle: "CS 631 Final Project, part 2"
author: "Grace Lawley"
date: "August 14th, 2018"
output: 
  xaringan::moon_reader:
    css: [default, metropolis, metropolis-fonts]
    nature:
      highlightStyle: atelier-lakeside-light
      highlightLines: false
      countIncrementalSlides: false
---

# The Dataset
--

* Child Language Data Exchange System (CHILDES)  

  + Online repository of language acquisition data
  
  + Corpora of child speech are very hard to come by
  
  + Used to study language development, language acquisition, etc.
  
--

* CHILDES → Eng-NA → **Kuczaj Corpus**

  + Longitudional Case Study
  
  + 1 target child: Abe
  
  + ~2 - ~5 years old
  
  + 210 transcripts (average of 810 words long)
  
---

# The Raw Data

* Pulled raw utterances data down from the CHILDES database with the `childesr` package

--

* Some raw utterances:
```{r echo = FALSE}
library(tidyverse)

kuczaj_raw <- read_csv("data/kuczaj_raw.csv")
kuczaj_raw$gloss[78:83]
```

--

* Cleaned, processed, & tokenized the data

---
# Sentiment Analysis

--

* Used the `nrc` Word-Emotion Association Lexicon in the `tidytext` package

--

  + Classifies words into 10 different sentiment categories: **anger**, **disgust**, **fear**, **joy**, **negative**, **positive**, **sadness**, **surprise**, and **trust**

--

* Merged with tokens with `dplyr::inner_join()` 

--

  + Only kept tokens that occured in both dataframes

---

# Chose a subset of 6

--

**Positive** 

--

+ *trust* 

+ *joy*

+ *anticipation*  

--

**Negative** 

--

+ *sadness*

+ *fear*

+ *anger*

---
# The Original Plot
```{r echo = FALSE, message = FALSE, warning = FALSE, dpi = 300, fig.width = 9, fig.height = 6}
library(ggridges)
library(egg)

kuczaj_nrc <- read_csv("data/kuczaj_nrc.csv")

positive_plot <- kuczaj_nrc %>% 
  filter(sentiment %in% c("joy", "trust", "anticipation")) %>% 
  ggplot(aes(x = age_years, y = sentiment, fill = sentiment)) +
    geom_density_ridges(alpha = 0.8, show.legend = FALSE) +
    labs(x = "", y = "", title = "Kuczaj Corpus & Sentiment",
         subtitle = "\nPositive Sentiments") +
    scale_y_discrete(expand = c(0.01, 0)) +
    scale_x_continuous(expand = c(0.01, 0)) +
    scale_fill_manual(values = c("#F6EFF7", "#D0D1E6", "#A6BDDB")) +
    theme_ridges(grid = FALSE) +
    theme(plot.title = element_text(size = 22, hjust = -0.2),
          plot.subtitle = element_text(size = 18, face = "italic"),
          axis.text.y = element_text(size = 16, face = "bold.italic"))
    
# Creating the negative subplot
negative_plot <- kuczaj_nrc %>% 
  filter(sentiment %in% c("anger", "sadness", "fear")) %>% 
  ggplot(aes(x = age_years, y = sentiment, fill = sentiment)) +
    geom_density_ridges(alpha = 0.7, show.legend = FALSE) +
    labs(x = "Age in Years", y = "", title = "",
         subtitle = "Negative Sentiments") +
    scale_y_discrete(expand = c(0.01, 0)) +
    scale_x_continuous(expand = c(0.01, 0)) +
    scale_fill_manual(values = c("#7999A8", "#1C9099", "#016C59")) +
    theme_ridges(grid = FALSE) +
    theme(plot.subtitle = element_text(size = 18, face = "italic"),
          axis.text.y = element_text(size = 16, face = "bold.italic"))

# Combining into one and plotting
egg::ggarrange(positive_plot, negative_plot, ncol = 1, nrow = 2)
```

---
# Problems

--

* Visualization is difficult to explain

--

* ~86% of tokens were lost when filtering against the NRC Word-Emotion Association Lexicon 

--

* Transcript length varies a lot

--

* Distribution of transcripts across the ages varies a lot

---
# Problems

* Visualization is difficult to explain

* ~86% of tokens were lost when filtering against the NRC Word-Emotion Association Lexicon 

* <span style="color:red">Transcript length varies a lot</span>

* Distribution of transcripts across the ages varies a lot


---
# Normalization

* Binned age into months

--

* For each age bin and each sentiment:

--

    * `n_percent = n_sentiment/n_tokens`

--
```{r echo = FALSE, dpi = 300, fig.width = 10.5, fig.height = 4}
# Sentiments to keep
sentiment_levels <- c("trust", "joy", "anticipation", 
                      "sadness", "fear", "anger")

# Making sentiment a factor
kuczaj <- kuczaj_nrc %>% 
  select(-age_years, -word) %>% # removing unneeded columns
  filter(sentiment %in% sentiment_levels) %>% 
  mutate(sentiment = factor(sentiment, levels = sentiment_levels))

# Taking the floor of age_months
ages_binned <- kuczaj %>% 
  mutate(age_months = floor(age_months)) 

# Removing the two edge bins
ages_binned <- ages_binned %>% 
  filter(age_months >= 29 & age_months <= 60)


# Counting the number of sentiments 
ages_binned <- ages_binned %>% 
  add_count(age_months, sentiment) %>% 
  rename(n_sentiment = n) %>% 
  distinct(age_months, sentiment, .keep_all = TRUE)


# Adding in count for total tokens per transcript that were kept
ages_binned <- ages_binned %>% 
  group_by(age_months) %>% 
  mutate(n_tokens = sum(n_sentiment)) %>% 
  ungroup()


# Creating the auxiliary table with all combinations
aux <- ages_binned %>% 
  expand(nesting(age_months, n_tokens), sentiment)

# Merging aux with ages_binned
ages_binned2 <- aux %>% 
  left_join(ages_binned, by = c("age_months", "n_tokens", "sentiment")) %>% 
  replace_na(list(n_sentiment = 0)) # replacing NA values with 0


# Normalizing!
ages_binned2 <- ages_binned2 %>% 
  mutate(percent = n_sentiment/n_tokens)

ggplot(ages_binned2, aes(age_months, n_tokens)) +
  geom_point() + 
  labs(title = "Total number of tokens per age bin") +
  theme_minimal()
```

---
class: inverse, center, middle
# Iterate!

---
# Version 1
```{r plot1, echo = FALSE, dpi = 300, fig.width = 9, fig.height = 5.5}
ggplot(ages_binned2, aes(age_months, percent, color = sentiment, linetype = sentiment)) +
  geom_line(size = 1) +
  theme_minimal()
```
  
---
# Version 2
```{r plot2, echo = FALSE, dpi = 300, fig.width = 9, fig.height = 5.5}
ggplot(ages_binned2, aes(age_months, percent, color = sentiment)) +
  geom_point(alpha = 0.7) +
  facet_wrap(~ sentiment) +
  guides(color = FALSE) +
  theme_minimal()
```

---
# Version 3
```{r plot3, echo = FALSE, dpi = 300, fig.width = 9, fig.height = 5.5}
ggplot(ages_binned2, aes(age_months, percent, fill = sentiment)) +
  geom_col(alpha = 0.7) +
  facet_grid(sentiment ~ .)+
  guides(fill = FALSE) +
  theme_minimal()
```

---
# Version 4
```{r plot4, echo = FALSE, dpi = 300, fig.width = 9, fig.height = 5.5}
ggplot(ages_binned2, aes(age_months, percent, fill = sentiment)) +
  geom_col(alpha = 0.7) +
  facet_wrap(~ sentiment) + 
  theme_minimal() +
  labs(x = "", y = "") +
  guides(fill = FALSE)
```

---
# Version 5
```{r plot5, echo = FALSE, dpi = 300, fig.width = 9, fig.height = 5.5}
positive_plot <- ages_binned2 %>% 
  filter(sentiment %in% c("trust", "joy", "anticipation")) %>% 
  ggplot(aes(age_months, percent, fill = sentiment)) +
    geom_col(alpha = 0.7, color = "white") +
    facet_wrap(~sentiment, ncol = 1, scale = "free_x") +
    theme_minimal() +
    labs(x = "", y = "", title = "Kuczaj Corpus & Sentiment") +
    guides(fill = FALSE) +
    scale_fill_manual(values = c("#97B8C7", "#AEC9C3", "#7FCCD3")) 

negative_plot <- ages_binned2 %>% 
  filter(sentiment %in% c("sadness", "fear", "anger")) %>% 
  ggplot(aes(age_months, percent, fill = sentiment)) +
    geom_col(alpha = 0.7, color = "white") +
    facet_wrap(~sentiment, ncol = 1, scale = "free_x") +
    theme_minimal() +
    labs(x = "", y = "") +
    guides(fill = FALSE) +
    scale_fill_manual(values = c("#21132B", "#4F406E", "#6C7399"))

ggarrange(positive_plot, negative_plot, ncol = 2, nrow = 1)
```

---
# Version 5.1
```{r plot5_1, echo = FALSE, dpi = 300, fig.width = 9, fig.height = 5.5}
positive_plot2 <- positive_plot +
  scale_y_continuous(breaks = c(0.05, 0.15, 0.25),
                     labels = c("5%", "15%", "25%")) +
  scale_x_continuous(breaks = c(30, 36, 42, 48, 54, 60),
                     labels = c("2.5 yrs", "3 yrs", "3.5 yrs", "4 yrs", "4.5 yrs", "5 yrs")) 

negative_plot2 <- negative_plot +
  scale_y_continuous(breaks = c(0.05, 0.15, 0.25),
                     labels = c("5%", "15%", "25%")) +
  scale_x_continuous(breaks = c(30, 36, 42, 48, 54, 60),
                     labels = c("2.5 yrs", "3 yrs", "3.5 yrs", "4 yrs", "4.5 yrs", "5 yrs")) 


ggarrange(positive_plot2, negative_plot2, ncol = 2, nrow = 1)
```

---
# Version 5.2
```{r plot5_2, echo = FALSE, dpi = 300, fig.width = 9, fig.height = 5.5}

positive_plot3 <- positive_plot2 +
  theme(plot.title = element_text(size = 18, face = "bold"),
        strip.text = element_text(size = 15, face = "italic"),
        axis.text.x = element_text(size = 10, face = "italic"),
        axis.text.y = element_text(size = 10, face = "italic"),
        axis.ticks.x = element_line())

negative_plot3 <- negative_plot2 +
  theme(strip.text = element_text(size = 15, face = "italic"),
        axis.text.x = element_text(size = 10, face = "italic"),
        axis.text.y = element_text(size = 10, face = "italic"),
        axis.ticks.x = element_line())

ggarrange(positive_plot3, negative_plot3, ncol = 2, nrow = 1)
```

---
class: inverse, center, middle

# Thank you!

*Github Repository:*   
[gracelawley/kuczaj-corpus](https://github.com/gracelawley/kuczaj-corpus)  
  
  
  
*Write up & code available at:*    
[grace.rbind.io/project/kuczaj_pt2/](/project/kuczaj_pt2/)
  
  
  
*Slides made with the R package* [xaringan](https://github.com/yihui/xaringan)  
These slides - [rendered](/slides/ruser_dataviz) & [raw](https://raw.githubusercontent.com/gracelawley/gracelawley/master/static/slides/ruser_dataviz.Rmd)    
  
*Based on my CS 631 Final Visualization Project*  
*Write up & code available at:*      
[grace.rbind.io/project/final_vis/](/project/final_vis/)  
